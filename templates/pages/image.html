{% extends 'base.html' %}

{% block title %}
Image
{% endblock title %}

{% block content %}

<h1 class="mb-3">Upload Image</h1>
<p class="text-muted">Upload an image to display it on the LED matrix. It will be resized to fit.</p>

<div class="row">
  <div class="col-12 col-md-8 col-lg-6">
    <form method="post" enctype="multipart/form-data" class="border rounded p-3 bg-white">
      <div class="form-group">
        <label for="file" class="small mb-1">Choose image file</label>
        <input type="file" name="file" id="file" class="form-control-file">
      </div>
      <div id="previewContainer" class="mb-3" style="display:none;">
        <label class="small mb-1 d-block">Preview</label>
        <img id="imagePreview" 
             src="#" 
             alt="Preview" 
             class="img-fluid rounded border"
             style="max-height: 220px; object-fit: contain;">
      </div>

      <button type="submit" class="btn btn-primary">Upload and display</button>
    </form>
    </form>
  </div>
</div>

{% endblock content %}

{% block scripts %}
<script>
  const fileInput = document.getElementById('file');
  const previewContainer = document.getElementById('previewContainer');
  const imagePreview = document.getElementById('imagePreview');

  fileInput.addEventListener('change', function() {
    const file = this.files[0];

    if (!file || !file.type.startsWith('image/')) {
      previewContainer.style.display = 'none';
      imagePreview.src = '#';
      return;
    }

    const reader = new FileReader();

    reader.onload = function(e) {
      imagePreview.src = e.target.result;
      previewContainer.style.display = 'block';
    };

    reader.readAsDataURL(file);
  });
</script>
{% endblock scripts %}
